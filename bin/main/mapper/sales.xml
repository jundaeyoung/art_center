<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.bclass.arts_center.repository.interfaces.AdminSalesRepository">

	<select id="selectRentSalesDtoList"
		resultType="com.bclass.arts_center.dto.RentSalesDto">
		SELECT r.start_date, r.start_time, r.end_date, r.end_time, s.title,
		l.location, h.name, u.nickname, r.rent_price
		FROM rent_place_reservation_tb AS r
		JOIN location_tb AS l
		ON r.location_id = l.id
		JOIN hole_tb AS h
		ON r.hole_id = h.id
		JOIN show_tb AS s
		ON r.show_id = s.id
		JOIN user_tb AS u
		ON r.user_id = u.id
		WHERE r.rent_place_status = 1
		ORDER BY r.start_date asc, r.end_date asc;
	</select>

	<select id="selectRentSaleGrape"
		resultType="com.bclass.arts_center.dto.RentSalesDto">
		SELECT s.title, l.location, h.name, u.nickname,
		sum(replace(r.rent_price,',','')) AS totalPrice
		FROM rent_place_reservation_tb AS r
		JOIN location_tb AS l
		ON r.location_id = l.id
		JOIN hole_tb AS h
		ON r.hole_id = h.id
		JOIN show_tb AS s
		ON r.show_id = s.id
		JOIN user_tb AS u
		ON r.user_id = u.id
		WHERE r.rent_place_status = 1
		GROUP BY s.title
		ORDER BY r.start_date asc, r.end_date asc;
	</select>

	<select id="selectShowSalesGrape" resultType="com.bclass.arts_center.dto.request.RequestManagerShowSaleDto">
		SELECT s.id, s.title,s.adult_rate,s.youth_rate,s.infant_rate,
		count(case when t.age_group_id=1 then 1 end) * replace(s.infant_rate,',','') +
		count(case when t.age_group_id=2 then 1 end) *
		replace(s.youth_rate,',','') +
		count(case when t.age_group_id=3 then 1 end) * replace(s.adult_rate,',','') as
		totalshowSales
		from ticketing_tb AS t
		join show_tb AS s
		ON t.show_id = s.id
		join show_datetime_tb AS sd
		ON t.show_datetime_id = sd.id
		where t.payment_status = 1
		group by s.title;
	</select>

</mapper>