<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper
	namespace="com.bclass.arts_center.repository.interfaces.UserRepository">

	<!-- 회원가입 -->
	<insert id="insertUser">
		INSERT INTO user_tb
		(user_name, password, nickname, 
		email, birth_date, tel, api_id, role_id)
		VALUES
		(#{userName}, #{password},
		#{nickname}, #{email}, #{birthDate}, #{tel}, #{apiId}, #{roleId})
	</insert>

	<!-- 비밀번호 암호화, 중복 아이디 확인 -->
	<select id="selectUserByUsername"
		resultType="com.bclass.arts_center.repository.model.User">
		SELECT * FROM user_tb
		WHERE user_name = #{userName}
	</select>
	
	
	<!-- 닉네임으로 유저정보 조회  -->
	<select id="selectUserBynickname"
		resultType="com.bclass.arts_center.repository.model.User">
		SELECT * FROM user_tb
		WHERE nickname = #{nickname}
	</select>
	
	<select id="selectUserById" resultType="com.bclass.arts_center.repository.model.User">
	SELECT * from user_tb where id = #{id}
	</select>
	
	<!-- admin 찾는거 -->
	<select id="selectUserList" resultType="com.bclass.arts_center.repository.model.User">
	select id, user_name, nickname, email, birth_date, tel, role_id, api_id  from user_tb where role_id = 1;
	</select>
	
	<select id="selectManagerList" resultType="com.bclass.arts_center.repository.model.User">
	select id, user_name, nickname, email, birth_date, tel, role_id, api_id  from user_tb where role_id = 2;
	</select>
	
	<select id="selectTeacherList" resultType="com.bclass.arts_center.repository.model.User">
	select id, user_name, nickname, email, birth_date, tel, role_id, api_id  from user_tb where role_id = 4;
	</select>

	<!-- api 아이디 있는지 확인 -->
	<select id="selectUserByApiId"
		resultType="com.bclass.arts_center.repository.model.User">
		SELECT * FROM user_TB WHERE api_id = #{apiId};
	</select>


	<!-- 로그인 -->
	<select id="selectUserByUsernameAndPassword"
		resultType="com.bclass.arts_center.repository.model.User">
		SELECT * FROM user_tb
		WHERE user_name = #{userName}
		AND
		password=#{password}
	</select>

	<!-- 수정 -->
	<update id="updateUserByUsername">
		UPDATE user_tb SET password = #{password},
		nickname = #{nickname}, email = #{email},
		tel =
		#{tel} WHERE user_name = #{userName}
	</update>

	
	<!-- 편용림 -->
	<!-- admin 회원 삭제 -->
	<delete id="deleteById">
		DELETE FROM user_tb WHERE user_name = #{id}
	</delete>
	
	<update id="updateUserById">
	UPDATE user_tb SET user_name = #{userName},
	nickname = #{nickname}, email = #{email},
	birth_date = #{birthDate}, tel = #{tel}
	WHERE id = #{id}
	</update>
	
	<select id="findUserByUserId"
		resultType="com.bclass.arts_center.repository.model.User">
		SELECT * FROM user_tb
		WHERE email = #{userEmail}
	</select>
	
	<update id="updateUserPassword">
		update user_tb set password=#{pw}
        where user_name=#{id};
	</update>
</mapper>