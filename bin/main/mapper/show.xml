<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.bclass.arts_center.repository.interfaces.ShowRepository">

	<!-- 작성자 : 전대영 show 최신순 -->
	<select id="selectShowByNewest" resultType="com.bclass.arts_center.dto.request.RequestShowDto">
		select s.id, s.title, round(avg(r.rating),1) as rating , s.content, sc.show_type,
		s.img_route from
		review_tb as r
		join show_tb as s
		on r.show_id = s.id
		join category_tb as sc
		on s.show_type_id = sc.id
		join user_tb as u
		on r.user_id = u.id
		GROUP BY s.title
		having s.show_status=1
		order by
		s.id desc
		limit #{begin},
		#{range}
	</select>

	<!-- 작성자 : 전대영 show 높은순 -->
	<select id="selectShowByHighesRated" resultType="com.bclass.arts_center.dto.request.RequestShowDto">
		select s.id, s.title, round(avg(r.rating),1) as rating , s.content, sc.show_type,
		s.img_route from
		review_tb as r
		join show_tb as s
		on r.show_id = s.id
		join category_tb as sc
		on s.show_type_id = sc.id
		join user_tb as u
		on r.user_id = u.id
		GROUP BY s.title
		having s.show_status=1
		order by round(avg(r.rating),1) desc
		limit #{begin},
		#{range}
	</select>


	<!-- 작성자 : 전대영 show 낮은순 -->
	<select id="selectShowByRowestRated" resultType="com.bclass.arts_center.dto.request.RequestShowDto">
		select s.id, s.title, round(avg(r.rating),1) as rating , s.content, sc.show_type,
		s.img_route from
		review_tb as r
		join show_tb as s
		on r.show_id =
		s.id
		join category_tb as sc
		on s.show_type_id = sc.id
		join user_tb as u
		on r.user_id = u.id
		GROUP BY s.title
		having s.show_status=1
		order by round(avg(r.rating),1) asc
		limit #{begin},
		#{range}
	</select>


	<!-- 작성자 : 전대영 show 카운터 -->
	<select id="selectShowCount" resultType="Integer">
		select count(*) AS
		count from(
		select s.id, s.title, s.content,
		s.img_route from
		review_tb as r
		join show_tb as s
		on r.show_id = s.id
		join user_tb as u
		on
		r.user_id =
		u.id
		GROUP BY s.title
		having s.show_status=1
		) as c
		
	</select>

	<!-- 작성자 : 전대영 show 낮은순 -->
	<select id="selectShowByCategory" resultType="com.bclass.arts_center.dto.request.RequestShowDto">
		select s.id, s.title, round(avg(r.rating),1) as rating , s.content, sc.show_type,
		s.img_route from
		review_tb as r
		join show_tb as s
		on r.show_id = s.id
		join category_tb as sc
		on s.show_type_id = sc.id
		join user_tb as u
		on r.user_id = u.id
		where sc.show_type=#{category}
		GROUP BY s.title
		having s.show_status=1
		order by round(avg(r.rating),1) asc
		limit #{begin},
		#{range}
	</select>


	<!-- 작성자 : 전대영 show 카운터 -->
	<select id="selectShowByCategoryCount" resultType="Integer">
		select count(*) AS
		count from(
		select s.id, s.title, s.content,
		s.img_route from
		review_tb as r
		join show_tb as s
		on r.show_id = s.id
		join user_tb as
		u
		on r.user_id =
		u.id
		join category_tb as sc
		on s.show_type_id = sc.id
		where sc.show_type=#{category}
		GROUP BY s.title
		having s.show_status=1
		) as c
	</select>

	<insert id="insertShow">
		INSERT INTO show_tb(img_route ,title, content, start_date, end_date, admission_age, adult_rate, youth_rate, infant_rate, organizer_id,show_type_id, hole_id)
		VALUES
		(#{imgRoute},#{title},#{content}, #{startDate},#{endDate},#{admissionAge},#{adultRate},#{youthRate},#{infantRate},#{organizerId}, #{showTypeId} ,#{holeId})
	</insert>


</mapper>


