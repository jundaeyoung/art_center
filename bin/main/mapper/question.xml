<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.bclass.arts_center.repository.interfaces.QuestionRepository">

	<!-- 작성자 : 전대영 question select -->
	<select id="selectQuestionByType" resultType="com.bclass.arts_center.dto.request.RequestQuestionDto">
		select q.id ,u.id as userId,u.user_name,r.role,
		q.title,q.content,q.answer_status,qc.question_type from question_tb as
		q
		join
		question_category_tb as
		qc
		on q.question_type_id = qc.id
		join
		user_tb as
		u
		on u.id = q.user_id
		join role_tb as r
		on u.role_id = r.id
		where
		qc.question_type = #{category}
		order by q.id desc
		limit #{begin},
		#{range};
	</select>

	<!-- 작성자 : 전대영 question 카운터 -->
	<select id="selectQuestionCount" resultType="Integer">
		select count(*)
		from question_tb
		where question_type_id = (
		select id
		from
		question_category_tb
		where question_type = #{category}
		);
	</select>


	<!-- 작성자 : 전대영 question 검색 -->
	<select id="selectQuestionBySearchText" resultType="com.bclass.arts_center.dto.request.RequestQuestionDto">
		select q.id ,u.id as userId,u.user_name,r.role,
		q.title,q.content,q.answer_status,qc.question_type from question_tb as
		q
		join
		question_category_tb as qc
		on q.question_type_id = qc.id
		join
		user_tb as
		u
		on u.id = q.user_id
		join role_tb as r
		on u.role_id = r.id
		where q.title
		like #{searchText} or q.content like #{searchText}
		order
		by
		q.id desc
		limit
		#{begin},
		#{range};
	</select>


	<!-- 작성자 : 전대영 question 검색 카운터 -->
	<select id="selectQuestionBySearchTextCount" resultType="Integer">
		select count(*) from question_tb
		where title
		like #{searchText} or content like #{searchText};
	</select>

	<insert id="insert">
		INSERT INTO question_tb(title, content, user_id,
		question_type_id)
		VALUES
		(#{title},#{content},#{userId},#{questionTypeId})
	</insert>

	<delete id="deleteById">
		delete from question_tb
		where id=#{id};
	</delete>


	<!-- 작성자 : 전대영 question all 검색 -->
	<select id="selectQuestionAll" resultType="com.bclass.arts_center.dto.request.RequestQuestionDto">
		select q.id ,u.id as userId,u.user_name,r.role,
		q.title,q.content,q.answer_status,qc.question_type from question_tb as
		q
		join
		question_category_tb as qc
		on q.question_type_id = qc.id
		join
		user_tb as
		u
		on u.id = q.user_id
		join role_tb as r
		on u.role_id = r.id
		order
		by q.id desc

	</select>

	<!-- 작성자 : 전대영 question all 검색 -->
	<select id="selectQuestionByQuestionId" resultType="com.bclass.arts_center.dto.request.RequestQuestionDto">
		select q.id ,u.id as userId,u.user_name,r.role,
		q.title,q.content,q.answer_status,qc.question_type from question_tb as
		q
		join
		question_category_tb as qc
		on q.question_type_id = qc.id
		join
		user_tb as
		u
		on u.id = q.user_id
		join role_tb as r
		on u.role_id = r.id
		where q.id=#{questionId}
		order
		by q.id desc
	</select>


	<delete id="deleteQuestionByQuestionId">
		delete from question_tb
		where id=#{questionId}
	</delete>
	
	

</mapper>


